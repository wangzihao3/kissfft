# DFT 手工计算练习

## 概述

本文档提供详细的 DFT 手工计算示例，帮助你深入理解 DFT 的计算过程和物理意义。

## DFT 公式回顾

**正变换：**
```
X[k] = Σ(n=0 to N-1) x[n] · e^(-j2πkn/N)
```

**逆变换：**
```
x[n] = (1/N) Σ(k=0 to N-1) X[k] · e^(j2πkn/N)
```

**旋转因子（Twiddle Factor）：**
```
W_N = e^(-j2π/N)
W_N^(kn) = e^(-j2πkn/N)
```

---

## 练习 1：N=2 的 DFT

### 问题

计算 x[n] = {a, b} 的 2 点 DFT。

### 解答

**DFT 公式：**
```
X[k] = Σ(n=0 to 1) x[n] · e^(-j2πkn/2)
     = Σ(n=0 to 1) x[n] · e^(-jπkn)
```

**计算 W_2 的幂：**
```
W_2^0 = e^0 = 1
W_2^1 = e^(-jπ) = -1
```

**k = 0:**
```
X[0] = x[0]·W_2^0 + x[1]·W_2^0
     = a·1 + b·1
     = a + b
```

**k = 1:**
```
X[1] = x[0]·W_2^0 + x[1]·W_2^1
     = a·1 + b·(-1)
     = a - b
```

**结果：**
```
X[k] = {a+b, a-b}
```

### 物理意义

- X[0] = a + b：直流分量（平均值 × 2）
- X[1] = a - b：交流分量（反映两个点的差异）

### 特殊情况

**常数序列：** x[n] = {c, c}
```
X[k] = {2c, 0}
```
只有直流分量，没有交流成分。

**反对称序列：** x[n] = {a, -a}
```
X[k] = {0, 2a}
```
只有交流分量，没有直流成分。

---

## 练习 2：N=3 的 DFT

### 问题

计算 x[n] = {1, 0, 0} 的 3 点 DFT（单位脉冲）。

### 解答

**旋转因子：**
```
W_3 = e^(-j2π/3) = cos(2π/3) - jsin(2π/3)
    = -1/2 - j(√3/2)
```

**k = 0:**
```
X[0] = 1·W_3^0 + 0·W_3^0 + 0·W_3^0 = 1
```

**k = 1:**
```
X[1] = 1·W_3^0 + 0·W_3^1 + 0·W_3^2 = 1
```

**k = 2:**
```
X[2] = 1·W_3^0 + 0·W_3^2 + 0·W_3^4 = 1
```

**结果：**
```
X[k] = {1, 1, 1}
```

### 物理意义

**单位脉冲的频谱是平坦的**：所有频率分量相等，这就是"白信号"的特性。

---

## 练习 3：N=4 的复指数序列

### 问题

计算 x[n] = {1, j, -1, -j} 的 4 点 DFT。

### 解答

**旋转因子：**
```
W_4 = e^(-j2π/4) = e^(-jπ/2) = -j
W_4^0 = 1
W_4^1 = -j
W_4^2 = -1
W_4^3 = j
```

**k = 0:**
```
X[0] = 1 + j - 1 - j = 0
```

**k = 1:**
```
X[1] = 1·1 + j·(-j) + (-1)·(-1) + (-j)·j
     = 1 + j·(-j) + 1 + (-j)·j

计算：j·(-j) = -j² = 1
       (-j)·j = -j² = 1

     = 1 + 1 + 1 + 1 = 4
```

**k = 2:**
```
X[2] = 1·1 + j·(-1) + (-1)·1 + (-j)·(-1)
     = 1 - j - 1 + j = 0
```

**k = 3:**
```
X[3] = 1·1 + j·j + (-1)·(-1) + (-j)·(-j)
     = 1 + j² + 1 + j²
     = 1 - 1 + 1 - 1 = 0
```

**结果：**
```
X[k] = {0, 4, 0, 0}
```

### 物理意义

这是一个**频率为 k=1 的纯净复指数信号**，DFT 结果只在 k=1 处有非零值。这是 DFT 的理想情况：单频信号对应频域的单根谱线。

---

## 练习 4：N=4 的实余弦信号

### 问题

计算 x[n] = {1, 0, -1, 0} 的 4 点 DFT。

**注：** 这是 cos(πn/2)，n = 0, 1, 2, 3

### 解答

**k = 0:**
```
X[0] = 1 + 0 - 1 + 0 = 0
```

**k = 1:**
```
X[1] = 1·1 + 0·(-j) + (-1)·(-1) + 0·j
     = 1 + 0 + 1 + 0 = 2
```

**k = 2:**
```
X[2] = 1·1 + 0·(-1) + (-1)·1 + 0·(-1)
     = 1 + 0 - 1 + 0 = 0
```

**k = 3:**
```
X[3] = 1·1 + 0·j + (-1)·(-1) + 0·(-j)
     = 1 + 0 + 1 + 0 = 2
```

**结果：**
```
X[k] = {0, 2, 0, 2}
```

### 验证对称性

对于实序列：
- X[1] = X*[4-1] = X*[3] ✓
- X[1] = X[3] = 2（实数，共轭等于自己）

### 物理意义

**实余弦信号的频谱是对称的**：
- 频率分量出现在 k=1 和 k=N-k=3 处
- 幅度相等（都是 2）
- 这是实信号频谱的典型特征

### 与欧拉公式的关系

```
cos(πn/2) = (e^(jπn/2) + e^(-jπn/2))/2
          = (频率为 +1 的分量 + 频率为 -1 的分量)/2

在 DFT 中：
- 频率 +1 → k=1
- 频率 -1 → k=N-1=3（因为 e^(-j2πn/N) 的周期性）

这就是为什么 X[1] = X[3] = 2
```

---

## 练习 5：N=8 的方波近似

### 问题

计算 x[n] = {1, 1, 0, 0, 0, 0, 0, 0} 的 8 点 DFT（矩形窗）。

### 解答（使用矩阵形式）

```
X[k] = Σ(n=0 to 7) x[n] · e^(-j2πkn/8)
```

由于 x[0] = x[1] = 1，其他都是 0：

```
X[k] = 1·W_8^0 + 1·W_8^k
     = 1 + e^(-j2πk/8)
     = 1 + e^(-jπk/4)
```

使用欧拉公式：
```
X[k] = 1 + cos(πk/4) - jsin(πk/4)
```

**逐个计算：**

| k | cos(πk/4) | sin(πk/4) | X[k] = 1 + cos - jsin | |X[k]| |
|---|-----------|-----------|------------------------|---------|
| 0 | 1 | 0 | 2 + j0 | 2 |
| 1 | √2/2 | √2/2 | 1+√2/2 - j√2/2 | ≈1.85 |
| 2 | 0 | 1 | 1 - j1 | ≈1.41 |
| 3 | -√2/2 | √2/2 | 1-√2/2 - j√2/2 | ≈0.77 |
| 4 | -1 | 0 | 0 + j0 | 0 |
| 5 | -√2/2 | -√2/2 | 1-√2/2 + j√2/2 | ≈0.77 |
| 6 | 0 | -1 | 1 + j1 | ≈1.41 |
| 7 | √2/2 | -√2/2 | 1+√2/2 + j√2/2 | ≈1.85 |

### 物理意义

1. **频谱泄漏**：短时信号（只有 2 个非零点）的能量分散到多个频率上
2. **主瓣**：在 k=0 处有最大值（低频成分）
3. **旁瓣**：随着频率增加，幅度逐渐减小
4. **对称性**：实序列的频谱关于 N/2 对称

### 与连续傅里叶变换的关系

矩形脉冲的 CFT 是 sinc 函数：
```
F(ω) = T · sinc(ωT/2)
```

DFT 结果是对 sinc 函数的采样，符合预期。

---

## 练习 6：验证 IDFT

### 问题

给定 X[k] = {10, -2+j2, -2, -2-j2}，验证 IDFT 能恢复 x[n] = {1, 2, 3, 4}。

### 解答

**IDFT 公式：**
```
x[n] = (1/4) Σ(k=0 to 3) X[k] · e^(j2πkn/4)
```

**n = 0:**
```
x[0] = (1/4)[X[0]·1 + X[1]·1 + X[2]·1 + X[3]·1]
     = (1/4)[10 + (-2+j2) + (-2) + (-2-j2)]
     = (1/4)[10 - 2 - 2 - 2 + j(2 - 2)]
     = (1/4)·4 = 1
```

**n = 1:**
```
x[1] = (1/4)[X[0]·1 + X[1]·j + X[2]·(-1) + X[3]·(-j)]

使用 X[1] = -2+j2, X[3] = -2-j2：

     = (1/4)[10·1 + (-2+j2)·j + (-2)·(-1) + (-2-j2)·(-j)]

计算各项：
     (-2+j2)·j = -2j + j²·2 = -2j - 2
     (-2-j2)·(-j) = 2j + j²·2 = 2j - 2

     = (1/4)[10 + (-2-2j) + 2 + (-2+2j)]
     = (1/4)[10 - 2 + 2 - 2 + j(-2j + 2j)]
     = (1/4)·8 = 2
```

**n = 2, 3：** 类似计算可得到 x[2] = 3, x[3] = 4 ✓

---

## 通用计算技巧

### 技巧 1：利用对称性

对于实序列 x[n]：
```
X[N-k] = X*[k]
```

只需计算前 N/2+1 个点（k = 0, 1, ..., N/2）

### 技巧 2：周期性

```
W_N^(kN) = 1
W_N^k = W_N^(k mod N)
```

例如：W_4^5 = W_4^(5 mod 4) = W_4^1 = -j

### 技巧 3：共轭性质

```
(x[n])* ⇔ (X[-k mod N])*
```

### 技巧 4：能量守恒（Parseval）

```
Σ|x[n]|² = (1/N) Σ|X[k]|²
```

可用于验证计算结果。

---

## 编程验证

### Python 验证示例

```python
import numpy as np

# 手工计算结果
x_manual = np.array([1, 2, 3, 4])
X_manual = np.array([10, -2+2j, -2, -2-2j])

# NumPy 验证
X_numpy = np.fft.fft(x_manual)

print("手工计算:", X_manual)
print("NumPy 计算:", X_numpy)
print("误差:", np.max(np.abs(X_manual - X_numpy)))
```

### C 验证示例

参考 `dft_demo.c` 和 `dft_idft_demo.c` 中的实现。

---

## 练习题

### 题目 1
计算 x[n] = {0, 1, 0, -1} 的 4 点 DFT。

### 题目 2
对于 x[n] = {1, 1, 1, 1}：
- 计算 DFT
- 解释结果的物理意义
- 验证 Parseval 定理

### 题目 3
设计一个 4 点序列，使其 DFT 结果为 X[k] = {0, 4, 0, 0}。

### 题目 4
证明：对于偶对称序列 x[n] = x[N-n]，其 DFT 是实数。

### 题目 5
计算 x[n] = {1, 2, 1, 0} 和 h[n] = {1, 1, 0, 0} 的循环卷积，用 DFT 验证。

---

## 总结

通过这些手工计算练习，你应该掌握：

1. ✅ DFT 的基本计算过程
2. ✅ 旋转因子的性质和使用
3. ✅ 实序列频谱的对称性
4. ✅ 不同信号的频谱特征
5. ✅ DFT 与 IDFT 的关系
6. ✅ Parseval 定理的验证

**下一步**：学习 FFT 算法，了解如何将 DFT 的计算复杂度从 O(N²) 降低到 O(N log N)。
