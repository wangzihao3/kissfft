# 频率检测程序分析

## 程序概述

该程序实现了一个基于 DFT 的频率检测器，能够识别信号中的主要频率成分。程序使用了 1024 点 DFT 来分析包含 50 Hz 和 120 Hz 正弦波的测试信号。

## 实现细节

### 1. DFT 计算

```c
void compute_dft(double *signal, double complex *dft, int N) {
    for (int k = 0; k < N; k++) {
        dft[k] = 0;
        for (int n = 0; n < N; n++) {
            double complex twiddle = cexp(-2.0 * PI * I * k * n / N);
            dft[k] += signal[n] * twiddle;
        }
    }
}
```

- 使用标准的 DFT 公式计算每个频率分量
- 时间复杂度：O(N²)
- 使用 C99 的复数库 `complex.h`

### 2. 幅值谱计算

```c
void compute_magnitude(double complex *dft, double *magnitude, int N) {
    for (int k = 0; k < N; k++) {
        magnitude[k] = cabs(dft[k]);
    }
}
```

- 计算每个频率分量的幅值
- 幅值 = sqrt(实部² + 虚部²)

### 3. 频率分量排序

使用 `qsort` 对频率分量按幅值降序排序，便于找出主要频率成分。

## 测试结果分析

### 输入信号
- 采样率：1000 Hz
- 采样点数：1024
- 信号组成：50 Hz + 0.5×120 Hz 正弦波

### 检测结果

| 排名 | 检测频率 (Hz) | 理论频率 (Hz) | 误差 (Hz) |
|------|---------------|---------------|-----------|
| 1    | 49.80         | 50            | -0.20     |
| 2    | 120.12        | 120           | +0.12     |

### 误差来源分析

1. **频率分辨率**：Δf = fs/N = 1000/1024 ≈ 0.98 Hz
   - 由于有限的频率分辨率，实际频率会被量化到最近的频率仓

2. **频谱泄漏**：
   - 信号周期不是 1024 采样点的整数倍
   - 导致能量扩散到相邻的频率仓
   - 可以通过加窗函数减少频谱泄漏

3. **数值精度**：
   - 使用双精度浮点数计算
   - 累积误差很小，可以忽略

## 性能分析

- DFT 计算：1024 × 1024 = 1,048,576 次复数乘加运算
- 在普通 PC 上约需要几毫秒
- 对于实时应用，应该使用 FFT 算法（O(N log N)）

## 改进建议

1. **使用 FFT 加速**：
   ```c
   // 使用 KissFFT 库
   void compute_fft(double *signal, double complex *fft, int N) {
       // 初始化 FFT 配置
       // 执行 FFT
   }
   ```

2. **加窗处理**：
   ```c
   void apply_hamming_window(double *signal, int N) {
       for (int n = 0; n < N; n++) {
           signal[n] *= 0.54 - 0.46 * cos(2*PI*n/(N-1));
       }
   }
   ```

3. **零填充**：
   - 增加采样点数可以提高频率分辨率
   - 在原始信号后补零

4. **峰值检测优化**：
   - 实现更智能的峰值检测算法
   - 考虑相位信息以提高精度

## 应用场景

这种频率检测技术可以用于：

1. **音频分析**：
   - 音符识别
   - 音调检测
   - 音质分析

2. **振动分析**：
   - 机械故障诊断
   - 结构健康监测

3. **通信系统**：
   - 载波检测
   - 频谱监测
   - 信号识别

## 总结

该程序成功实现了基本的频率检测功能，准确识别了测试信号中的主要频率成分。虽然使用 DFT 而非 FFT 导致计算效率较低，但对于小规模信号分析仍然有效。进一步优化可以集中在算法加速和精度提升上。